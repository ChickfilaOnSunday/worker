#!/usr/bin/env python

import os
from time import sleep
from os import environ as ENV
import worker
from farnsworth import Job

job_id = int(ENV['JOB_ID'])

while True:
    print "[Worker] Waiting for jobs..."
    job = Job.find(job_id)
    if job is not None:
        print "[Worker] Running job #%s" % job_id
        work = None
        if job.worker == 'afl':
            work = worker.AFLWorker()

        job.started()
        work.run(job)
        job.completed()
        print "[Worker] Done job #%s" % job_id
        break
    sleep(3)
